# Telegram Bot для планирования отправки ссылок

Бот для автоматической отправки ссылок в указанное время в другой Telegram бот.

## Функционал

- Принимает ссылки от пользователя
- Запрашивает время отправки в формате HH:MM (например, 15:05)
- Автоматически отправляет ссылку в целевой бот в указанное время

## Установка и запуск локально

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Настройте переменные окружения в файле `.env`:
```
BOT_TOKEN=ваш_токен_бота
TARGET_BOT_TOKEN=токен_бота_получателя
TARGET_BOT_USERNAME=имя_бота_получателя
TARGET_BOT_CHAT_ID=chat_id_бота_получателя (опционально, можно получить через /get_chat_id)
```

3. Запустите бота:
```bash
python bot.py
```

## Развертывание на Railway.com

1. Создайте новый проект на [Railway.com](https://railway.com)

2. Подключите ваш GitHub репозиторий или загрузите файлы напрямую

3. В настройках проекта добавьте переменные окружения:
   - `BOT_TOKEN` - токен вашего бота
   - `TARGET_BOT_TOKEN` - токен бота-получателя
   - `TARGET_BOT_USERNAME` - имя бота-получателя (без @)
   - `TARGET_BOT_CHAT_ID` - chat_id бота-получателя (опционально, можно получить через команду /get_chat_id)

4. Railway автоматически определит `Procfile` и запустит бота

5. Убедитесь, что в настройках проекта выбран тип "Worker" (не Web)

## Использование

1. Отправьте боту команду `/start`
2. Отправьте ссылку (должна начинаться с http://, https:// или www.)
3. Укажите время отправки в формате HH:MM (например, 15:05)
4. Бот автоматически отправит ссылку в указанное время

## Команды

- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/list` - Показать список запланированных отправок
- `/get_chat_id` - Получить chat_id целевого бота (для настройки переменной окружения TARGET_BOT_CHAT_ID)

## Настройка chat_id целевого бота

Для корректной работы бота необходимо получить chat_id целевого бота. Есть несколько способов:

### Способ 1: Через getUpdates (самый простой)

1. **Сначала отправьте сообщение целевому боту:**
   - Откройте Telegram
   - Найдите бота `@smeshnoto4kabot`
   - Отправьте ему команду `/start` или любое сообщение

2. **Запустите скрипт:**
   ```bash
   python get_chat_id_from_updates.py
   ```
   
   Скрипт проанализирует обновления целевого бота и найдет chat_id.

### Способ 2: Автоматический скрипт

Запустите скрипт для автоматической инициализации:

```bash
python init_bot_chat.py
```

Скрипт попробует несколько методов для получения chat_id и выведет результат.

### Способ 2: Через команду в боте

1. Запустите вашего бота
2. Отправьте команду `/get_chat_id` вашему боту
3. Бот попытается получить chat_id целевого бота
4. Добавьте полученный chat_id в переменную окружения `TARGET_BOT_CHAT_ID`

### Способ 3: Через команду в боте

1. Запустите вашего бота
2. Отправьте команду `/get_chat_id` вашему боту
3. Бот попытается получить chat_id целевого бота
4. Добавьте полученный chat_id в переменную окружения `TARGET_BOT_CHAT_ID`

### Способ 4: Ручная инициализация

Если автоматические методы не работают, смотрите подробную инструкцию в файле `get_chat_id_manual.md`

### ⚠️ ВАЖНО: Ограничение Telegram API

**Боты не могут отправлять сообщения друг другу напрямую** - это ограничение Telegram Bot API.

### Решения:

1. **Если целевой бот в группе/канале:**
   - Добавьте вашего бота в эту группу/канал
   - Используйте chat_id группы/канала (отрицательное число)
   - Добавьте его в `TARGET_BOT_CHAT_ID`

2. **Если нужно отправлять именно боту:**
   - Убедитесь, что целевой бот может получать сообщения от других ботов
   - Используйте chat_id, полученный через `/get_chat_id`
   - Проверьте логи на Railway для детальной информации об ошибках

### Решение конфликта getUpdates:

Если видите ошибку `Conflict: terminated by other getUpdates request`:
- Остановите все локальные запуски бота
- Убедитесь, что на Railway запущен только один экземпляр
- Бот автоматически очистит обновления при запуске

Подробнее: см. файл `РЕШЕНИЕ_ПРОБЛЕМ.md`

## Технологии

- Python 3.8+
- aiogram 3.7.0
- python-dotenv
